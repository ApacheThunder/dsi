.arch armv5te
.fpu softvfp
.eabi_attribute 23, 1
.eabi_attribute 24, 1
.eabi_attribute 25, 1
.eabi_attribute 26, 1
.eabi_attribute 30, 2
.eabi_attribute 18, 4

.global _start
.section .init

#define REGION_USA 45
#define REGION_EUR 56

#define	REG_BASE	0x04000000

#define savpath 0x020bcb88

#if REGCODE==REGION_USA

#define dFS_Open 0x020851cc
#define dFS_Close 0x02085250

#define dFS_Read 0x02085374
#define dFS_Write 0x0208543c

#define dFS_Seek 0x02085348

#define dFS_InitCtx 0x20849ec

#elif REGCODE==REGION_EUR

#define dFS_Open 0x020851FC
#define dFS_Close 0x02085280

#define dFS_Read 0x020853A4
#define dFS_Write 0x0208546C

#define dFS_Seek 0x02085378

#define dFS_InitCtx 0x02084A1C

#else
//#error "Unsupported region."
#endif

_start:
.arm
mov r1, #0x1f
msr cpsr, r1
add r1, pc, #1
bx r1

.thumb

nop

mov r0, sp
ldr r4, =dFS_InitCtx
blx r4

mov r0, sp
ldr r1, =savpath
mov r2, #1
ldr r4, =dFS_Open
blx r4

mov r0, sp
mov r4, #0x2c
lsl r4, #8
sub r4, #4

mov r1, #0x0020
lsl r1, #4
add r1, #0x20
lsl r1, #16
mov r7, r1
sub r1, r4
mov r2, #0xd4
lsl r2, #8
add r2, #4
add r2, r4
@ldr r4, =dFS_Read
ldr r4, =dFS_Seek
add r4, #0x2c
blx r4

mov r0, sp
@ldr r4, =dFS_Close
ldr r4, =dFS_Open
add r4, #0x84
blx r4

mov r1, r7
bx r1

fail_lp:
b fail_lp

.byte 0x55, 0x55 @ padding
.pool

