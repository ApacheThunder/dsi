ifeq ($(strip $(REGION)),)
$(error "Set the REGION Makefile parameter.")
endif

HAXID	:=	0

include ../haxx_rules

REGCODE	:=	00
ifeq ($(REGION),USA)
	REGCODE	:=	45
endif
ifeq ($(REGION),EUR)
	REGCODE	:=	56
endif
ifeq ($(REGCODE),00)
	$(error "Unsupported region.")
endif

all:	savedata.bin

clean:
	rm -f $(HAXNAME).elf savedata.bin $(TID)$(REGCODE)hax_crypt.sav.$(HAXVER) $(HAXNAME)_crypt.ban.$(HAXVER) $(TID)$(REGCODE).tmd.sha1 $(TID)$(REGCODE)hax.savedata.sha1 $(HAXNAME).banner.sha1

savedata.bin: $(HAXNAME).elf
	arm-eabi-objcopy -O binary $(HAXNAME).elf savedata.bin
	../sudokusum/sudokusum savedata.bin
	cp $(TID)$(REGCODE)in.savedata $(TID)$(REGCODE)hax.savedata
	sudo mount -o loop $(TID)$(REGCODE)hax.savedata $(HAXNAME)
	sudo cp ./savedata.bin $(HAXNAME)/savedata.bin
	sudo umount $(HAXNAME)
	cp $(TID)$(REGCODE)hax.savedata public.sav
	../dumprawsav/dumprawsav --insav=$(CURDIR)/$(TID)$(REGCODE)hax.savedata --inban=$(CURDIR)/$(HAXNAME).banner --cryptsav=$(CURDIR)/$(TID)$(REGCODE)hax_crypt.sav.$(HAXVER) --cryptban=$(CURDIR)/$(HAXNAME)_crypt.ban.$(HAXVER) --hashsav=$(TID)$(REGCODE)hax.savedata.sha1 --hashban=$(HAXNAME).banner.sha1

$(HAXNAME).elf:	$(HAXNAME).s
	arm-eabi-gcc -x assembler-with-cpp -nostartfiles -nostdlib -DREGCODE=$(REGCODE) $< -o $(HAXNAME).elf

